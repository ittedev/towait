(()=>{var s,n=class{constructor(e,t=[],r=[0]){this.builtin=e,this.data=t,this.dataLengths=r}push(e=[]){for(const t of e)this.data.push(t);this.dataLengths.push(e.length)}add(e){this.data.push(e),this.dataLengths[this.dataLengths.length-1]++}pop(){let e=this.dataLengths.pop()||0;for(;e--;)this.data.pop()}get(t){var e=this.builtin(t);if(e)return e;for(let e=this.data.length-1;0<=e;e--)if(this.data[e][0]===t)return this.data[e][1]}clone(){return new n(this.builtin,this.data.slice(),this.dataLengths.slice())}},w=e=>e.replace(/[|{}.*+?()\[\]-^$\\]/g,"\\$&");(V=s=s||{})[V.null=0]="null",V[V.term=1]="term",V[V.evaluation=2]="evaluation",V[V.literal=3]="literal",V[V.variable=4]="variable",V[V.tiny=5]="tiny",V[V.titan=6]="titan",V[V.filter=7]="filter",V[V.block=8]="block",V[V.if=9]="if",V[V.else=10]="else",V[V.switch=11]="switch",V[V.case=12]="case",V[V.default=13]="default",V[V.for=14]="for",V[V.end=15]="end",V[V.var=16]="var",V[V.let=17]="let",V[V.include=18]="include",V[V.defaults=19]="defaults";var u,v=class{constructor(e,t=[]){this.type=s.evaluation,this._isTitantNode=!0,this.node=e,this.params=t}trace(t){this.node=this.node.trace(t);for(let e=this.params.length-1;0<=e;e--)this.params[e]=this.params[e].trace(t);return t(this)}evalute(t){const e=this.node.evalute(t);return"function"==typeof e?e(...this.params.map(e=>e.evalute(t))):e}},g=class{constructor(e){this.type=s.literal,this._isTitantNode=!0,this.value=e}trace(e){return e(this)}evalute(e){return this.value}},m=class{constructor(e){this.type=s.variable,this._isTitantNode=!0,this.name=e}trace(e){return e(this)}evalute(e){return e.get(this.name)}};(W=u=u||{})[W.dot=0]="dot",W[W.leftSquare=1]="leftSquare",W[W.rightSquare=2]="rightSquare",W[W.leftRound=3]="leftRound",W[W.rightRound=4]="rightRound",W[W.pipe=5]="pipe",W[W.comment=6]="comment",W[W.comma=7]="comma",W[W.exclamation=8]="exclamation",W[W.question=9]="question",W[W.colon=10]="colon",W[W.equal=11]="equal",W[W.null=12]="null",W[W[void 0]=13]="undefined",W[W.boolean=14]="boolean",W[W.block=15]="block",W[W.if=16]="if",W[W.else=17]="else",W[W.for=18]="for",W[W.in=19]="in",W[W.switch=20]="switch",W[W.case=21]="case",W[W.default=22]="default",W[W.include=23]="include",W[W.let=24]="let",W[W.var=25]="var",W[W.end=26]="end",W[W.number=27]="number",W[W.string=28]="string",W[W.operator=29]="operator",W[W.word=30]="word",W[W.space=31]="space",W[W.partial=32]="partial",W[W.other=33]="other";var a=e=>({value:e,type:(()=>{switch(e){case"block":return u.block;case"if":return u.if;case"else":return u.else;case"for":return u.for;case"in":return u.in;case"switch":return u.switch;case"case":return u.case;case"default":return u.default;case"include":return u.include;case"let":return u.let;case"var":return u.var;case"end":return u.end;case"false":case"true":return u.boolean;case"null":return u.null;case"undefined":return u.undefined;case"|":case"&":return u.partial;case"+":case"-":case"*":case"/":case"%":case"==":case"===":case"!=":case"!==":case"<":case">":case"<=":case">=":case"||":case"&&":return u.operator;case".":return u.dot;case"[":return u.leftSquare;case"]":return u.rightSquare;case"|>":return u.pipe;case"(":return u.leftRound;case")":return u.rightRound;case"!":return u.exclamation;case"?":return u.question;case":":return u.colon;case",":return u.comma;case"=":return u.equal}switch(!0){case/^\s+$/.test(e):return u.space;case/^\/\/.*$/.test(e):return u.comment;case/^[_\$a-zA-Z][_\$a-zA-Z0-9]*$/.test(e):return u.word;case/^'([^']|\\')*$|^"([^"]|\\")*$/.test(e):return u.partial;case/^'([^']|\\')*'$|^"([^"]|\\")*"$/.test(e):return u.string;case/^\d+\.?\d*$|^\.?\d+$/.test(e):return u.number;default:return u.other}})()}),r=(e,t=[])=>""===e?t:r(e.slice(1),((e,t)=>{var r,n;return e.length?(r=e.pop(),(n=a(r.value+t)).type===u.other?e.push(r,a(t)):e.push(n)):e.push(a(t)),e})(t,e[0])),c=(e,t)=>{e=e[e.length-1];return e&&e.type===t},i=e=>{switch(e){case"!":return 70;case"*":case"/":case"%":return 60;case"+":case"-":return 50;case"<":case">":case"<=":case">=":return 40;case"==":case"!=":case"===":case"!==":return 30;case"&&":return 20;case"||":return 10}},l=(e,t,r="")=>{if(!e||e.type!==t)throw new Error(r)},o=(e,t)=>{l(e.pop(),u.leftRound);const r=[];for(;!c(e,u.rightRound)&&(r.push(q(e)),c(e,u.comma));)e.pop();l(e.pop(),u.rightRound);t=new v(t,r);return c(e,u.dot)||c(e,u.leftSquare)?p(e,t):c(e,u.leftRound)?o(e,t):t},p=(t,e)=>{var r=(()=>{switch(t.pop().type){case u.dot:var e=t.pop();return l(e,u.word),new g(e.value);case u.leftSquare:e=q(t);return l(t.pop(),u.rightSquare),e}})(),e=new v(new m("."),[r,e]);return c(t,u.dot)||c(t,u.leftSquare)?p(t,e):c(t,u.leftRound)?o(t,e):e},h=e=>{var t=e.pop();switch(t.type){case u.word:return c(e,u.dot)||c(e,u.leftSquare)?p(e,new m(t.value)):c(e,u.leftRound)?o(e,new m(t.value)):new v(new m(t.value));case u.number:case u.string:case u.boolean:return new g((e=>{switch(e.type){case u.number:return Number(e.value);case u.undefined:return;case u.null:return null;case u.boolean:return"true"===e.value;case u.string:return'"'===e.value[0]?e.value.slice(1,-1).replace('\\"','"'):e.value.slice(1,-1).replace("\\'","'");default:throw new Error}})(t));case u.exclamation:return new v(new m(t.value),[h(e)]);case u.operator:switch(t.value){case"-":case"+":return new v(new m(t.value),[h(e)]);default:throw new Error}case u.leftRound:var r=q(e);return l(e.pop(),u.rightRound),r;default:throw new Error(JSON.stringify(t))}},d=e=>{const t=new Array;for(t.push(h(e));c(e,u.operator);){var r=e.pop();if("!"===r.value)break;t.push(r.value),t.push(h(e))}for(;1<t.length;)for(let e=0;e+1<t.length;e+=2){var n;(e+3>=t.length||i(t[e+1])>i(t[e+3]))&&(n=new v(new m(t[e+1]),[t[e+2],t[e]]),t.splice(e,3,n))}return"string"==typeof t[0]?new m(t[0]):t[0]},f=e=>{let t=d(e);for(;c(e,u.question);)t=((e,t)=>{l(e.pop(),u.question);const r=[];return r.push(q(e)),l(e.pop(),u.colon),r.push(d(e)),r.push(t),new v(new m("?:"),r)})(e,t);return t},y=e=>{var t=e[e.length-1];if(void 0===t)return!1;switch(t.type){case u.word:case u.number:case u.string:case u.boolean:case u.leftRound:case u.exclamation:return!0;case u.operator:switch(t.value){case"-":case"+":return!0;default:return!1}default:return!1}},b=(t,e)=>e.trace(e=>e.type===s.evaluation&&e.node.type===s.variable&&"_"===e.node.name?t:e),$=e=>{l(e.pop(),u.pipe);var t=(()=>{if(c(e,u.operator)||c(e,u.exclamation)||c(e,u.word))return new m(e.pop().value);if(y(e))return h(e);throw new Error})();const r=[];for(;y(e);)r.push(h(e));let n=!1;const a=new v(t,r).trace(e=>(e.type===s.variable&&"_"===e.name&&(n=!0),e));return n||a.params.push(new v(new m("_"))),c(e,u.pipe)?b(a,$(e)):a},q=e=>{var t=f(e);return c(e,u.pipe)?b(t,$(e)):t},R=e=>{e=r(e).filter(e=>e.type!==u.space).reverse();return 0===e.length?new g(""):q(e)},e=(e,s,t)=>{var r=t.line.length<=1?`${w(t.line)}{3,}`:w(t.line),n=w(t.open),t=w(t.close);const a=new RegExp(`^(.*)(?<!\\\\)${r}(.*)$`),u=new RegExp(`\\\\(${r})(.*)`,"g"),c=e=>e.replace(u,"$1$2"),i=new RegExp(`(?<!\\\\)${n}.*?(?<!\\\\)${t}`,"g"),l=new RegExp(`(?<!\\\\)${n}(.*?)(?<!\\\\)${t}`,"g"),o=new RegExp(`\\\\(${n}|${t})`,"g"),p=e=>e.replace(o,"$1"),h=e.split("\n"),d=[],f=[];return h.forEach((e,t)=>{var r=e.match(a);r?(f.length&&(d.push(f.join("\n")),f.length=0),r=((e,t,r)=>{t=r?new v(new m("escape"),[t]):t;return new v(new m("prefix"),[new g(e),t])})(r[1],R(c(r[2])),s),d.push(t<h.length-1?(t=r,new v(new m("append"),[new g("\n"),t])):r)):f.push(c(e))}),f.length&&d.push(f.join("\n")),d.map(e=>{if("string"!=typeof e)return e;{var t=e.split(i),r=[...e.matchAll(l)];const a=[p(t[0])];for(let e=0;e<r.length;e++)a.push((n=R(p(r[e][1])),new v(new m(s?"escape":"output"),[n]))),a.push(p(t[e+1]));return a}var n})},k=(n,a)=>n.reduce((e,t,r)=>"string"==typeof t?e+t:Array.isArray(t)?e+k(t,a)+(r<n.length-1?"\n":""):e+t.evalute(a)+(t.type===s.titan&&r<n.length-1?"\n":""),""),x=class{constructor(e,t){this.tiny=e,this.templateText=t,this.block=null}compile(){this.block||(this.block=e(this.templateText.replace(/\r\n/g,"\n"),this.tiny.useEscape,this.tiny.delimiter))}render(e={}){this.compile(),this.tiny.stack.push(Object.entries(e));e=k(this.block,this.tiny.stack);return this.tiny.stack.pop(),e}},t=(e,t)=>t[e],E=e=>!e,S=(e,t)=>void 0===t?e:t+e,T=(e,t)=>void 0===t?-e:t-e,_=(e,t)=>t*e,j=(e,t)=>t/e,A=(e,t)=>t%e,L=(e,t)=>t==e,N=(e,t)=>t===e,O=(e,t)=>t!=e,z=(e,t)=>t!==e,Z=(e,t)=>t<e,F=(e,t)=>e<t,J=(e,t)=>t<=e,B=(e,t)=>e<=t,C=(e,t)=>t||e,D=(e,t)=>t&&e,G=(e,t,r)=>r?e:t,H=e=>"string"==typeof e||"number"==typeof e&&Number.isFinite(e)?""+e:"",I=/[<>&"'`]/g,K=e=>{const t=H(e);return t&&t.replace(I,e=>{switch(e){case"<":return"&lt;";case">":return"&gt;";case"&":return"&amp;";case'"':return"&quot;";case"'":return"&#39;";case"`":return"&#x60;"}})},M=(t,e)=>{const r=H(e);return r?r.split("\n").map(e=>H(t)+e).join("\n"):""},P=(t,e)=>{const r=H(e);return r?r.split("\n").map(e=>e+H(t)).join("\n"):""},Q=(e,t)=>{t=H(t);return t?t+H(e):""},U=(e,t)=>{t=H(t);return t?H(e)+t:""},V=e=>{switch(e){case".":return t;case"!":return E;case"+":return S;case"-":return T;case"*":return _;case"/":return j;case"%":return A;case"==":return L;case"===":return N;case"!=":return O;case"!==":return z;case"<":return Z;case">":return F;case"<=":return J;case">=":return B;case"||":return C;case"&&":return D;case"?:":return G;case"output":return H;case"escape":return K;case"prefix":return M;case"suffix":return P;case"append":return Q;case"prepend":return U}},W=class{constructor(e=!0,t={},r=new n(V)){this.stack=r,this.useEscape=e,this.delimiter={line:t.line||":",open:t.open||"{|",close:t.close||"|}"}}render(e,t){const r=new x(this,e);return r.render(t)}compile(e){const t=new x(this,e);return t.compile(),t}let(e,t){if(t)this.stack.add([e,t]);else for(var[r,n]of Object.entries(e))this.stack.add([r,n])}},V=new W;window.Tiny=W,window.TinyTemplate=x,window.tiny=V})();